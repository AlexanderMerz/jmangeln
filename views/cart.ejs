<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=no"
        />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>J&M Angeln - Warenkorb</title>
        <% include includes/styles %>
        <link rel="stylesheet" href="/styles/cart.css" />
    </head>

    <body>
        <% include includes/navigation %>

        <main>
            <div class="heading">
                <h1>Warenkorb</h1>
            </div>
            <% if (cart && cart.length > 0) { %>
                <% for (const product of cart) { %>
                    <div
                        class="product"
                        data-id="<%= product.data._id %>"
                        data-size="<%= product.size %>"
                        data-color="<%= product.color %>"
                        data-quantity="<%= product.quantity %>"
                    >
                        <img src="/images/merch_many.jpg" alt="Produktbild" />
                        <div class="product__info">
                            <h1><%= product.data.name %></h1>
                            <h2 class="price">
                                <%= (product.quantity * product.data.price).toFixed(2)
                                %> €
                            </h2>
                            <% if (product.size) { %>
                            <h2>Größe: <%= product.size %></h2>
                            <% } %> <% if (product.color) { %>
                            <h2>Farbe: <%= product.color %></h2>
                            <% } %>
                            <h2>Anzahl: <%= product.quantity %></h2>
                        </div>
                        <span class="remove">&#10006;</span>
                    </div>
            <% } %>
            <div class="total flex-column">
                <h1><%= total.toFixed(2) %> €</h1>
                <a href="/order/checkout" class="btn">JETZT KAUFEN</a>
            </div>
            <% } else { %>
                <div class="flex-column">
                    <p class="empty">Es befinden sich keine Produkte im Warenkorb.</p>
                    <br>
                    <a href="/merch" class="btn">Zum Shop</a>
                </div>
            <% } %>
        </main>
    </body>
    <script>
        Array.from(document.querySelectorAll('.remove')).forEach(remove => {
            remove.addEventListener('click', async function() {
                const response = await fetch(
                    `/api/cart/remove/${this.parentElement.dataset.id}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.parentElement.dataset)
                    }
                );
                const { status } = await response.json();
                if (status === 200) {
                    console.log(200);
                    window.location.reload();
                }
            });
        });
    </script>
</html>
