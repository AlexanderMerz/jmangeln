<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>J&M Angeln - Checkout</title>
    <script src="https://www.paypal.com/sdk/js?client-id=<%= clientID %>&currency=EUR&disable-funding=sofort"></script>
    <% include includes/styles %>
    <link rel="stylesheet" href="/styles/checkout.css">
</head>
<body>

    <% include includes/navigation %>

    <main class="centered">

        <h1 class="light">Bestellübersicht</h1>

        <hr>

        <section class="flex-column">
            <% for (const product of cart) { %>
                <div class="flex-row max-width">
                    <h2 class="light">
                        <span><%= product.quantity %></span>
                        <span>&nbsp;x&nbsp;</span>
                        <span><%= product.data.name %></span>
                        <span><%= product.size || '' %></span>
                        <span><%= product.color || '' %></span>
                    </h2>
                    <h2 class="light price">
                        <%= (product.data.price * product.quantity).toFixed(2) %> €
                    </h2>
                </div>
            <% } %>
        </section>

        <hr>

        <section class="flex-column">
            <div class="flex-row max-width">
                <h2 class="light total">Gesamtwert</h2>
                <h2 class="light total price"><%= (total).toFixed(2) %> €</h2>
            </div>
        </section>

        <br>

        <div id="paypal-button-container"></div>

        <script>
            paypal.Buttons({
                createOrder: function(data, actions) {
                    // This function sets up the details of the transaction, including the amount and line item details.
                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: parseFloat('<%= total %>').toFixed(2)
                            }
                        }]
                    });
                },
                onApprove: function(data, actions) {
                    console.log(data);
                    // This function captures the funds from the transaction.
                    return actions.order.capture().then(function(details) {
                        // This function shows a transaction success message to your buyer.
                        window.location = '/order/confirmation';
                    });
                }
            }).render('#paypal-button-container');
        </script>

</body>
</html>
